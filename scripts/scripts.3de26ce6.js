"use strict";angular.module("usermanagementTestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","oauthio"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/getting-started",{templateUrl:"views/getting-started.html",controller:"GettingStartedCtrl"}).when("/signin",{templateUrl:"views/signin.html",controller:"SigninCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/user",{templateUrl:"views/user.html",controller:"UserCtrl"}).when("/logout",{controller:"LogoutCtrl",templateUrl:"views/blank.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","User","Materia",function(a,b,c){console.log(c.getOAuthdURL()),b.initialize("ZamGgPBUtpLOYv21t-WQAhoULcY"),a.isLogged=b.isLogged(),a.isLogged&&(a.me=b.getIdentity()),a.providersAvailable=["facebook","twitter","google","linkedin","github","vk"]}]),angular.module("usermanagementTestApp").controller("MainCtrl",["$rootScope",function(a){a.menu="home"}]),angular.module("usermanagementTestApp").controller("SignupCtrl",["$rootScope","$scope","$location","OAuth","User",function(a,b,c,d,e){return a.menu="signup",e.isLogged()?c.path("/user"):(b.signup=function(b){e.signup(b).done(function(b){a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){console.log("error",a)})},void(b.signupSocial=function(f){d.popup(f).done(function(d){e.signup(d).done(function(b){console.log("signed up",b),a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){console.log(a),b.error=a})}).fail(function(a){console.log(a),b.error=a})}))}]),angular.module("usermanagementTestApp").controller("SigninCtrl",["$rootScope","$scope","$location","OAuth","User",function(a,b,c,d,e){return a.menu="signin",e.isLogged()?c.path("/user"):(b.signin=function(d,f){e.signin(d,f).done(function(b){a.me=b,a.isLogged=!0,c.path("/user"),a.$apply()}).fail(function(a){b.error=a})},void(b.signinSocial=function(f){d.popup(f).done(function(d){e.signin(d).done(function(b){a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){console.log(a),b.error=a})}).fail(function(a){console.log(a),b.error=a})}))}]),angular.module("usermanagementTestApp").controller("UserCtrl",["$rootScope","$scope","$location","$modal","User","OAuth",function(a,b,c,d,e,f){return a.menu="user",e.isLogged()?(b.hasProvider=function(b){return a.me.hasProvider(b)},b.toggleProvider=function(c){b.hasProvider(c)?a.me.removeProvider(c):f.popup(c).done(function(b){a.me.addProvider(b),a.$apply()})},b.select=function(a){var c=d.open({templateUrl:"views/modal/provider.html",controller:"ProviderCtrl",resolve:{provider:function(){return a}}});c.result.then(function(c){"unlink"===c&&b.toggleProvider(a)})},b.editData=function(c){console.log("editData",c);var e=d.open({templateUrl:"views/modal/data.html",controller:"DataModalCtrl",size:"sm",resolve:{data:function(){return{key:c.key,value:c.value,type:typeof c.value}}}});e.result.then(function(){b.editableData=a.me.getEditableData()})},a.me.getProviders(),void(b.editableData=a.me.getEditableData())):c.path("/signin")}]),angular.module("usermanagementTestApp").controller("LogoutCtrl",["$rootScope","User","$location",function(a,b,c){b.isLogged()||c.path("/"),a.me=null,a.isLogged=!1,b.getIdentity().logout().done(function(){}).fail(function(a){console.log(a)}),c.path("/")}]),angular.module("usermanagementTestApp").controller("DataModalCtrl",["$rootScope","$scope","$location","$modalInstance","User","data",function(a,b,c,d,e,f){e.isLogged()||(d.dismiss(),c.path("/signin")),b.data=f;var g=f.key,h=function(){var a=b.data.value;if("object"===b.data.type)try{a=JSON.parse(a)}catch(c){return null}else"object"===b.data.type&&(a=parseInt(a));return a};b.save=function(){console.log(g,b.data),""!==g&&g!==b.data.key&&(console.log("edit key"),a.me.data[g]=null);var c=h();a.me.data[b.data.key]=c,console.log(a.me.data),a.me.save(),d.close()},b.close=function(){d.dismiss()}}]),angular.module("usermanagementTestApp").controller("ProviderCtrl",["$scope","$modalInstance","provider",function(a,b,c){console.log(c),a.provider=c,a.unlink=function(){b.close("unlink")},a.close=function(){b.dismiss()}}]);